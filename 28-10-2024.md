# **Training on 28-10-2024**

## 1. is_active 

The is_active field in Django is typically a Boolean field (models.BooleanField) used to indicate whether a particular record is active or inactive. It’s commonly found in models to allow "soft deletions" (deactivating instead of deleting records) and is often used in authentication to mark a user as active or inactive.

```python
is_active = models.BooleanField(default=True) 
```
Update all the models with the field is_active.

```python
class Departments(models.Model):
    hod_name=models.ForeignKey('app_Teacher.Teacher2',on_delete=models.DO_NOTHING,null=True,blank=True)
    dept_name=models.CharField(max_length=100)
    dept_id=models.AutoField(primary_key=True)
    sc_id = models.ForeignKey('app_School.School', on_delete=models.DO_NOTHING,null=True,blank=True)
    created_on = models.DateTimeField(auto_now_add=True)
    updated_on=models.DateTimeField(auto_now=True)
    is_active=models.BooleanField(default=True)
```

## 2. ActiveManager
In Django, an Active Manager is a specialized Manager that allows you to define custom querysets and methods for a model. Managers in Django are responsible for database operations, and by default, every model has at least one manager called objects. However, you can create custom managers to define complex queries or filter specific subsets of data.

```python
class ActiveManager(models.Manager):
    def  get_queryset(self):
        return super().get_queryset().filter(is_active=True)
```
* **Purpose**: Filters the default queryset to include only records where is_active=True.

* **Usage**: Add active = ActiveManager() to your model, then use ModelName.active.all() to get only active items.
  
In the models.py file we write 

```python
objects = models.Manager()  # The default manager
active_objects = ActiveManager()
```
Now we need to perform some tasks:

Inactivate a `school`, `department`, `teacher`, or `student`.

<!-- 2. When inactivating a school, all corresponding departments, teachers, and students within that school must also be inactivated.

1. When inactivating a department, all corresponding teachers and students within that department must also be inactivated.

2. When inactivating a student, the teacher's performance record must be updated.

3. When inactivating the teacher no other fields will change.   -->


## 1. Inactivating school

While inactivating a school the corresponding Department,student and teacher will be inactive.
```python
class SchooldeactivateView(APIView):
    #deactivating the schood by id
    def put(self, request, sc_id):
        try:
            # Deactivate the school
            school = School.objects.filter(sc_id=sc_id).update(is_active=False)
            if school == 0:
                return Response({"error": "School not found"}, status=status.HTTP_204_NO_CONTENT)

            # Deactivate related departments
            departments = Departments.objects.filter(school_departments_list__sc_id=sc_id)
            departments.update(is_active=False)

            # Deactivate teachers associated with these departments
            teachers = Teacher2.objects.filter(department__in=departments)
            teachers.update(is_active=False)

            # Deactivate students associated with these departments
            students = Student1.objects.filter(dept_id__in=departments)
            students.update(is_active=False)

            return Response({"message": "School and associated records set to inactive successfully"}, status=status.HTTP_200_OK)

        except Exception as e:
            return Response({"error": str(e)}, status=status.HTTP_400_BAD_REQUEST)
```
The `SchooldeactivateView` is a Django REST Framework API view that handles deactivating a school and its related records through a `PUT` request. Here’s a concise overview:

1. **Deactivate School**: It attempts to deactivate the school identified by `sc_id`, setting `is_active` to `False`. If no school is found, it returns a 204 No Content response.

2. **Deactivate Related Records**:
   - **Departments**: All departments linked to the school are also marked as inactive.
   - **Teachers**: Teachers associated with these departments have their `is_active` status set to `False`.
   - **Students**: Students linked to the deactivated departments are marked inactive.

3. **Response**: If successful, it returns a 200 OK response with a success message. If any errors occur, it catches the exception and returns a 400 Bad Request with the error details.

*Output*
```json
{
    "message": "School and associated records set to inactive successfully"
}
```


